
{% extends "layout.html" %}

{% block body %}
    <style>
        #main {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100vh;
        }

        #main h1 {
            align-self: flex-start;
            margin: 40px 40px 40px 0;
        }

        svg {
            position: absolute;
        }

        circle:nth-of-type(1) { fill: #ffffff; }
        circle:nth-of-type(2) { fill: #fcd837; }
        circle:nth-of-type(3) { fill: #f9a11f; }
        circle:nth-of-type(4) { fill: #f27c21; }

        #clackers {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #images {
            display: none;
            width: 100vw;
            height: 100vh;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            overflow-x: hidden;
        }

        .image {
            width: 320px;
            height: 480px;
            margin: 8px;
            border: 2px solid #fff;
            border-radius: 16px;
            position: relative;
            transition: ease-in 0.2s;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }

        .image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 16px;
            object-fit: cover;
            border: none;
        }

        .image .text {
            background-color: #ffffff;
            position: absolute;
            bottom: 0px;
            left: 0;
            right: 0;
            z-index: 2;
            color: #000000;
            padding: 16px;
            border-radius: 0 0 16px 16px;
            text-align: center;
        }

        #images .circle-btn {
            display: block;
            height: 50px;
            width: 50px;
            border-radius: 50%;
            border: 1px solid #fefefe;
            margin-top: 24px;
            font-size:22px;
        }

        #images #circle-btn-right {
            position: absolute;
            right: 10px;
        }

        #images #circle-btn-left {
            position: absolute;
            left: 10px;
        }

        #message {
            position: absolute;
            transform: translate(-50%, -50%);
            display: none;
            left: 50%;
            top: 50%;
            font-size: 20px;
        }

        input {
            z-index: 100000;
        }
    </style>

    <div class="container-fluid" id="main">
        <div class="container">
            <h1>SIX DEGREES OF BACON</h1>
            <p>
                Six Degree of bacon is a game which connect any one in Hollywood
                to Kevin Bacon in 6 steps or less. Enter the name of any Hollywood
                Star which you want to start at and another star you wish to connect
                to.
            </p>
            <div class="form-inline">
                <label for="star1" class="mb-2 mr-sm-2">Connect :</label>
                <input type="text" class="form-control mb-2 mr-sm-2" autocomplete="off" id="star1" name="star1" value="tom cruise">
                <label for="star2" class="mb-2 mr-sm-2">To: </label>
                <input type="text" class="form-control mb-2 mr-sm-2" autocomplete="off" id="star2" name="star2" value="tom hanks">
                <div class="form-check-label">
                    <button type="submit" class="btn btn-success mb-2" id="button">Submit</button>
                </div>
            </div>
            <div class="suggestions">
                <p>Suggestions: <span id="txtHint"></span></p>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div id="images">
            <input class="circle-btn btn-success" id="circle-btn-right" type="submit" value=">">
            <input class="circle-btn btn-success" id="circle-btn-left" type="submit" value="<">
        </div>
    </div>

    <div id="message"></div>

    <svg width="300" height="120" id="clackers">
        <!-- Left arc path -->
        <svg>
        <path id="arc-left-up" fill="none" d="M 90 90 A 90 90 0 0 1 0 0"/>
        </svg>
        <!-- Right arc path -->
        <svg>
        <path id="arc-right-up" fill="none" d="M 100 90 A 90 90 0 0 0 190 0"/>
        </svg>
        
        <text x="150" y="50" fill="#ffffff" font-family="Helvetica Neue,Helvetica,Arial" font-size="18"
            text-anchor="middle">
        L O A D I N G
        </text>
        <circle cx="15" cy="15" r="15">
        <!-- I used a python script to calculate the keyPoints and keyTimes based on a quadratic function. -->
        <animateMotion dur="1.5s" repeatCount="indefinite"
            calcMode="linear"
            keyPoints="0.0;0.19;0.36;0.51;0.64;0.75;0.84;0.91;0.96;0.99;1.0;0.99;0.96;0.91;0.84;0.75;0.64;0.51;0.36;0.19;0.0;0.0;0.05;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0"
            keyTimes="0.0;0.025;0.05;0.075;0.1;0.125;0.15;0.175;0.2;0.225;0.25;0.275;0.3;0.325;0.35;0.375;0.4;0.425;0.45;0.475;0.5;0.525;0.55;0.575;0.6;0.625;0.65;0.675;0.7;0.725;0.75;0.775;0.8;0.825;0.85;0.875;0.9;0.925;0.95;0.975;1.0">
            <mpath xlink:href="#arc-left-up"/>
        </animateMotion>
        </circle>
        <circle cx="135" cy="105" r="15" />
        <circle cx="165" cy="105" r="15" />
        <circle cx="95" cy="15" r="15">
        <animateMotion dur="1.5s" repeatCount="indefinite"
            calcMode="linear"
            keyPoints="0.0;0.0;0.05;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0.0;0.19;0.36;0.51;0.64;0.75;0.84;0.91;0.96;0.99;1.0;0.99;0.96;0.91;0.84;0.75;0.64;0.51;0.36;0.19;0.0"
            keyTimes="0.0;0.025;0.05;0.075;0.1;0.125;0.15;0.175;0.2;0.225;0.25;0.275;0.3;0.325;0.35;0.375;0.4;0.425;0.45;0.475;0.5;0.525;0.55;0.575;0.6;0.625;0.65;0.675;0.7;0.725;0.75;0.775;0.8;0.825;0.85;0.875;0.9;0.925;0.95;0.975;1.0">
            <mpath xlink:href="#arc-right-up"/>
        </animateMotion>
        </circle>
    </svg>

    <script>
        var scraped_data;
        var current_slide = 0;
        var images = document.getElementById('images'); // Gets images div

        // Displays the loading page
        document.getElementById('button').addEventListener('click', () => {
            // Gets the inputted values
            const star1 = document.getElementById('star1').value;
            const star2 = document.getElementById('star2').value;

            // Displays the loading screen
            document.getElementById('main').style.display = 'none';
            document.getElementById('clackers').style.display = 'block';

            // Server request
            const request = new XMLHttpRequest();
            request.open('POST', '/connection');

            // When request finish loading
            request.onload = () => {
                var data = JSON.parse(request.responseText); // Extracts the JSON data
                scraped_data = data;
                document.getElementById('clackers').style.display = 'none';

                if (data.success == false) {
                    let message = document.getElementById('message');
                    message.innerHTML = data.message;
                    message.style.display = 'flex';
                    return;
                }

                // Loops through the extracted JSON data
                for (let [key, value] of Object.entries(data.route0)) {
                    // Image div for the scraped image
                    console.log(`${key}: ${value}`)
                    let image = document.createElement('div');
                    image.className = 'image';

                    // img element created
                    let img = document.createElement('img');
                    img.className = 'main-img';
                    img.src = `${value}`;
                    img.alt = `${key}`;

                    // img tag and image div are added to the DOM
                    image.appendChild(img);
                    images.appendChild(image);

                    // Creates a div and span for the actor's name
                    let image_text = document.createElement('div');
                    image_text.className = 'text';
                    let text = document.createElement('h5');
                    text.className = 'main-text';
                    text.innerHTML = `${key}`;
                    image_text.appendChild(text);
                    image.appendChild(image_text);
                }
                // Makes the images div visible
                images.style.display = 'flex';
            }

            // Add data to send with request
            const data = new FormData();
            data.append('star1', star1);
            data.append('star2', star2);

            // Send request
            request.send(data)
            return false;
        });

        document.getElementById('circle-btn-right').addEventListener('click', () => {
            // Keeps track of what slide we are on
            let scrapedDataLength = Object.keys(scraped_data).length;
            if (current_slide == scrapedDataLength - 1)
                current_slide = current_slide;

            else
                current_slide++;

            // Gets the imgs and texts tags
            let images = document.querySelectorAll('.main-img');
            let texts = document.querySelectorAll('.main-text');

            // Sets an index to loop over the selected tags
            let index = 0;
            let key_index = "route" + current_slide;
            
            for (let [key, value] of Object.entries(scraped_data[`${key_index}`])) {
                // Changes the src and alt value of the img tags
                let img = images[index];
                img.src = value;
                img.alt = key;

                // Changes the text to match the scraped data
                texts[index].innerHTML = key;
                index++;
            }
        });

        document.getElementById('circle-btn-left').addEventListener('click', () => {
            // Keeps track of what slide we are on
            if (current_slide == 0)
                current_slide = current_slide;

            else
                current_slide--;

            // Gets the imgs and texts tags
            let images = document.querySelectorAll('.main-img');
            let texts = document.querySelectorAll('.main-text');
            let scrapedDataLength = Object.keys(scraped_data).length;

            // Sets an index to loop over the selected tags
            let index = 0;
            let key_index = "route" + current_slide;
            
            for (let [key, value] of Object.entries(scraped_data[`${key_index}`])) {
                // Changes the src and alt value of the img tags
                let img = images[index];
                img.src = value;
                img.alt = key;

                // Changes the text to match the scraped data
                texts[index].innerHTML = key;
                index++;
            }
        });

        // Shows suggestions for the star1 input field
        const star1 = document.getElementById('star1');
        document.getElementById('star1').addEventListener('keyup', () => {
            showHint(star1.value, star1);
        });

        // Shows suggestions for the star2 input field
        const star2 = document.getElementById('star2');
        document.getElementById('star2').addEventListener('keyup', () => {
            showHint(star2.value, star2);
        });

        // Makes a server request to get name suggestions
        function showHint(str, elementName) {
            str = str.trim();
            if (str.length == 0) {
                document.getElementById("txtHint").innerHTML = "";
                return;
            }

            const request = new XMLHttpRequest;
            request.open('POST', '/gethint');

            request.onload = () => {
                const data = JSON.parse(request.responseText); // Extracts the JSON data
                console.log(data);
                
                let suggestions = '';
                for (let [key, value] of Object.entries(data)) {
                    suggestions += value + ', ';
                }
                document.getElementById('txtHint').innerHTML = suggestions;
            }

            const data = new FormData();
            data.append('input', str);

            // Send request
            request.send(data);
            return false;
        }


    </script>
{% endblock %}
